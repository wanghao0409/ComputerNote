# Kafka

把Kafka想象成一个**超级高效的“快递系统”**。

## 主题topic



1. **消息/Record**：你要寄送的“包裹”，就是一条条数据。
2. **主题/Topic**：包裹的“收货地址”。比如你有订单数据，就发到 `order_topic`；有日志数据，就发到 `log_topic`。
3. **分区/Partition**：**这是Kafka高并发的核心！** 一个“地址”（Topic）下面有多个“货架”（Partition）。消息被均匀地存放在这些货架上。
   - **好处**：允许多个“快递员”（Producer）同时往不同货架放包裹，多个“取件员”（Consumer）同时从不同货架取包裹，实现超高并发。
   - **分区内有序**：同一个货架上的包裹是按顺序摆放的（消息有序）。不同货架之间的顺序无法保证。
4. **生产者/Producer**：负责发货的“快递员”。它决定把包裹放到哪个“地址”（Topic）的哪个“货架”（Partition）上。
5. **消费者/Consumer**：负责取件的“取件员”。它从指定的“地址”（Topic）的一个或多个“货架”（Partition）上取包裹。
6. **消费者组/Consumer Group**：**这是Kafka横向扩展的核心！**
   - 一组“取件员”（Consumer）组成一个团队（Group），共同处理一个“地址”（Topic）的所有包裹。
   - **核心规则**：一个分区（Partition）在同一时间只能被**同一个消费者组内**的**一个消费者**消费。
   - **例子**：Topic-A有3个分区（P0, P1, P2），消费者组G1有2个消费者（C1, C2）。那么分配可能是：C1消费P0和P1，C2消费P2。如果G1新加入一个消费者C3，Kafka会重新分配，可能变成C1->P0, C2->P1, C3->P2。**通过增加消费者，可以实现消费能力的线性扩展。**
7. **Broker**：就是一个个Kafka服务器，构成了整个“快递公司”。
8. **副本/Replica**：**这是Kafka高可用的核心！** 每个“货架”（Partition）都有几个一模一样的备份，分散在不同的“快递站点”（Broker）里。其中一个备份是“主管”（Leader），负责所有读写；其他备份是“员工”（Follower），只负责从Leader那里同步数据。如果Leader宕机，会从Follower中选举一个新的Leader。